<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Roja AI Chat</title>
<style>
Â  * { box-sizing: border-box; }
Â  body { font-family: 'Poppins', sans-serif; margin: 0; background-color: #0a0f24; color: #fff; display: flex; flex-direction: column; min-height: 100vh; }

Â  .chat-header { display: flex; align-items: center; justify-content: space-between; padding: 12px 18px; background: linear-gradient(135deg, #111831, #1c244a); border-bottom: 1px solid #2a2f4a; position: fixed; top: 0; left: 0; right: 0; z-index: 10; box-shadow: 0 2px 10px rgba(0,0,0,0.4); }
Â  .chat-header-left { display: flex; align-items: center; }
Â  .chat-header img { width:48px; height:48px; border-radius:50%; object-fit:cover; margin-right:10px; border:2px solid #0078ff; }
Â  .chat-header h2 { margin:0; font-size:20px; font-weight:600; }
Â  .chat-header-right button { background:#1f2745; border:none; color:#bbb; font-size:14px; padding:6px 10px; border-radius:6px; cursor:pointer; transition:0.3s; }
Â  .chat-header-right button:hover { color:#fff; background:#0078ff; }

Â  .chat-box { flex:1; overflow-y:auto; scroll-behavior:smooth; display:flex; flex-direction:column; padding:15px; margin-top:75px; margin-bottom:80px; }
Â  .message { margin:10px 0; max-width:75%; padding:12px 16px; border-radius:12px; line-height:1.6; word-wrap:break-word; position:relative; animation:fadeIn 0.3s ease; }
Â  .user { background:#0078ff; align-self:flex-end; border-bottom-right-radius:0; margin-right:5px; }
Â  .bot { background:#1b2140; align-self:flex-start; border-bottom-left-radius:0; margin-left:5px; }
Â  .bot pre { margin:0; white-space:pre-wrap; }

Â  .typing-indicator { display:flex; align-items:center; gap:3px; }
Â  .typing-indicator span { width:6px; height:6px; background:#0078ff; border-radius:50%; display:inline-block; animation:bounce 0.6s infinite alternate; }
Â  .typing-indicator span:nth-child(2) { animation-delay:0.2s; }
Â  .typing-indicator span:nth-child(3) { animation-delay:0.4s; }

Â  @keyframes bounce { to { transform: translateY(-5px); } }
Â  @keyframes fadeIn { from { opacity:0; transform:translateY(10px); } to { opacity:1; transform:translateY(0); } }

Â  .copy-btn { position:absolute; bottom:8px; right:8px; background:#0078ff; color:white; border:none; font-size:12px; padding:4px 8px; border-radius:5px; cursor:pointer; opacity:0; transition:0.2s; }
Â  .bot:hover .copy-btn { opacity:1; }
Â  .copy-btn:hover { background:#005ec3; }

Â  .chat-input { position:fixed; bottom:0; left:0; right:0; display:flex; padding:12px; background:#141a35; border-top:1px solid #2a2f4a; z-index:20; }
Â  .chat-input input { flex:1; padding:10px 14px; border:none; border-radius:8px; font-size:15px; outline:none; background:#1f2745; color:#fff; }
Â  .chat-input button { background:#0078ff; color:#fff; border:none; padding:10px 18px; margin-left:10px; border-radius:8px; cursor:pointer; transition:0.2s; }
Â  .chat-input button:hover { background:#0060d4; }

Â  .footer { text-align:center; padding:8px; font-size:12px; color:#aaa; font-style:italic; position:fixed; bottom:60px; left:0; right:0; background:transparent; }

Â  #chatHistoryPanel { position:fixed; top:75px; right:-320px; width:300px; height:calc(100% - 75px); background:#141a35; border-left:1px solid #2a2f4a; overflow-y:auto; transition:0.3s; padding:10px; z-index:15; }
Â  #chatHistoryPanel h3 { color:#fff; font-size:16px; margin-bottom:10px; }
Â  #chatHistoryList li { padding:6px; margin-bottom:4px; border-radius:6px; cursor:pointer; color:#fff; }
Â  #openHistoryBtn { position:fixed; top:85px; right:10px; z-index:20; padding:6px 10px; border:none; background:#1f2745; color:#fff; border-radius:6px; cursor:pointer; }
</style>
</head>
<body>

<div class="chat-header">
Â  <div class="chat-header-left">
Â  Â  <img src="roja-avatar.png" alt="Roja AI Avatar">
Â  Â  <h2>Roja AI</h2>
Â  </div>
Â  <div class="chat-header-right">
Â  Â  <button onclick="newChat()">Percakapan Baru</button>
Â  Â  <button onclick="toggleFullscreen()">Fullscreen</button>
Â  </div>
</div>

<div class="chat-box" id="chatBox"></div>

<div class="chat-input">
Â  <input id="userInput" type="text" placeholder="Ketik pesan..." />
Â  <button onclick="sendMessage()">Kirim</button>
</div>

<div class="footer">copyright@RojaServer | V2</div>

<div id="chatHistoryPanel">
Â  <h3>Riwayat Chat</h3>
Â  <ul id="chatHistoryList"></ul>
Â  <button onclick="closeHistory()">Tutup</button>
</div>
<button id="openHistoryBtn">Riwayat</button>

<script>
const chatBox = document.getElementById('chatBox');
const input = document.getElementById('userInput');
const chatHistoryPanel = document.getElementById('chatHistoryPanel');
const chatHistoryList = document.getElementById('chatHistoryList');
const openHistoryBtn = document.getElementById('openHistoryBtn');

const GEMINI_API_KEY = "AIzaSyC310duBltZgbkMMfqRoAn6qVELo7x2slI";Â 
const GEMINI_URL = "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent";

let conversationHistory = [];

window.onload = function() {
Â  const saved = localStorage.getItem('roja_chat');
Â  const savedHistory = localStorage.getItem('roja_history');
Â  if (saved) {
Â  Â  chatBox.innerHTML = saved;
Â  Â  conversationHistory = JSON.parse(savedHistory || "[]");
Â  } else {
Â  Â  appendBot("Halo, aku Roja AI ğŸ¤–. Ada yang bisa aku bantu hari ini?");
Â  }
Â  chatBox.scrollTop = chatBox.scrollHeight;
};

async function sendMessage() {
Â  const msg = input.value.trim();
Â  if (!msg) return;
Â  appendUser(msg);
Â  input.value = "";

Â  const typingDiv = appendBot("", true);
Â  conversationHistory.push({ role: "user", content: msg });

Â  try {
Â  Â  const contextPrompt = conversationHistory.map(m => `${m.role === "user" ? "User" : "AI"}: ${m.content}`).join("\n");
Â  Â  const res = await fetch(`${GEMINI_URL}?key=${GEMINI_API_KEY}`, {
Â  Â  Â  method: "POST",
Â  Â  Â  headers: { "Content-Type": "application/json" },
Â  Â  Â  body: JSON.stringify({ contents: [{ parts: [{ text: contextPrompt }] }] })
Â  Â  });
Â  Â  const data = await res.json();
Â  Â  let reply = data?.candidates?.[0]?.content?.parts?.[0]?.text || "âš ï¸ Tidak ada respons dari AI.";

Â  Â  const isCodeRequest = /buatkan kode|html|css|javascript|js|php|python|csharp|java/i.test(msg);
Â  Â  if (isCodeRequest) {
Â  Â  Â  reply = `<pre><code>${reply.replace(/</g,"&lt;").replace(/>/g,"&gt;")}</code></pre>`;
Â  Â  }

Â  Â  typingDiv.innerHTML = `${reply}<button class="copy-btn" onclick="copyText(this, ${isCodeRequest})">Copy</button>`;
Â  Â  conversationHistory.push({ role: "model", content: reply });

Â  } catch (err) {
Â  Â  console.error(err);
Â  Â  typingDiv.textContent = "âŒ Gagal menghubungi API Gemini.";
Â  }

Â  saveChat();
Â  chatBox.scrollTop = chatBox.scrollHeight;
}

function appendUser(text) {
Â  const div = document.createElement("div");
Â  div.className = "message user";
Â  div.textContent = text;
Â  chatBox.appendChild(div);
Â  saveChat();
Â  chatBox.scrollTop = chatBox.scrollHeight;
}

function appendBot(text, isTyping=false) {
Â  const div = document.createElement("div");
Â  div.className = "message bot";
Â  if(isTyping) div.innerHTML = `<div class="typing-indicator"><span></span><span></span><span></span></div>`;
Â  else div.innerHTML = `${text}<button class="copy-btn" onclick="copyText(this)">Copy</button>`;
Â  chatBox.appendChild(div);
Â  saveChat();
Â  chatBox.scrollTop = chatBox.scrollHeight;
Â  return div;
}

function copyText(btn, isCode=false) {
Â  let text;
Â  if (isCode) {
Â  Â  text = btn.parentElement.querySelector("pre code")?.innerText || "";
Â  } else {
Â  Â  text = btn.parentElement.innerText.replace("Copy","").trim();
Â  }
Â  navigator.clipboard.writeText(text);
Â  btn.textContent = "âœ… Disalin";
Â  setTimeout(()=>btn.textContent="Copy",2000);
}

function saveChat() {
Â  localStorage.setItem('roja_chat', chatBox.innerHTML);
Â  localStorage.setItem('roja_history', JSON.stringify(conversationHistory));
}

function newChat() {
Â  if (confirm("Mulai percakapan baru?")) {
Â  Â  if (conversationHistory.length > 0) {
Â  Â  Â  let savedAllHistory = JSON.parse(localStorage.getItem('roja_all_history') || "[]");
Â  Â  Â  savedAllHistory.push([...conversationHistory]);
Â  Â  Â  localStorage.setItem('roja_all_history', JSON.stringify(savedAllHistory));
Â  Â  }
Â  Â  chatBox.innerHTML = "";
Â  Â  conversationHistory = [];
Â  Â  appendBot("Percakapan baru dimulai. Halo, aku Roja AI ğŸ¤–");
Â  Â  saveChat();
Â  }
}

function toggleFullscreen() {
Â  if (!document.fullscreenElement) document.documentElement.requestFullscreen();
Â  else document.exitFullscreen();
}

input.addEventListener("keypress", e => { if (e.key==="Enter") sendMessage(); });

openHistoryBtn.onclick = () => { chatHistoryPanel.style.right = "0"; renderHistory(); };
function closeHistory() { chatHistoryPanel.style.right="-320px"; }

function renderHistory() {
Â  chatHistoryList.innerHTML="";
Â  const allHistory = JSON.parse(localStorage.getItem('roja_all_history') || "[]");
Â  if (allHistory.length===0) chatHistoryList.innerHTML='<li style="color:#aaa;">Belum ada percakapan sebelumnya.</li>';
Â  else allHistory.forEach((conv, convIdx)=>{
Â  Â  const li=document.createElement('li');
Â  Â  li.style.background="#1b214033";
Â  Â  li.textContent=`[Percakapan ${convIdx+1}] ${conv.map(m=>m.content).join(" | ").substring(0,50)}${conv.map(m=>m.content).join(" ").length>50?"...":""}`;
Â  Â  li.onclick=()=>loadHistoryConversation(convIdx);
Â  Â  chatHistoryList.appendChild(li);
Â  });
}

function loadHistoryConversation(convIdx) {
Â  const allHistory=JSON.parse(localStorage.getItem('roja_all_history')||"[]");
Â  if(!allHistory[convIdx]) return;
Â  chatBox.innerHTML="";
Â  conversationHistory=[...allHistory[convIdx]];
Â  conversationHistory.forEach(msg=>{
Â  Â  if(msg.role==="user") appendUser(msg.content);
Â  Â  else appendBot(msg.content);
Â  });
Â  closeHistory();
}
</script>
</body>
</html>
