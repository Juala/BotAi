<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Roja AI Chat</title>
<style>
  * { box-sizing: border-box; }
  body {
    font-family: 'Poppins', sans-serif;
    margin: 0;
    background-color: #0a0f1c;
    color: #fff;
    display: flex;
    flex-direction: column;
    height: 100vh;
  }

  .chat-container {
    flex: 1;
    overflow-y: auto;
    padding: 15px;
    display: flex;
    flex-direction: column;
    scroll-behavior: smooth;
  }

  .message {
    max-width: 80%;
    padding: 10px 14px;
    border-radius: 12px;
    margin-bottom: 12px;
    line-height: 1.4;
    white-space: pre-wrap;
  }

  .user-message {
    align-self: flex-end;
    background-color: #1e88e5;
  }

  .bot-message {
    align-self: flex-start;
    background-color: #252b3f;
  }

  .input-container {
    display: flex;
    align-items: center;
    padding: 10px;
    background-color: #111726;
  }

  #user-input {
    flex: 1;
    padding: 10px;
    border: none;
    border-radius: 10px;
    outline: none;
    font-size: 15px;
    background-color: #1b2236;
    color: white;
  }

  button {
    background-color: #1e88e5;
    color: white;
    border: none;
    border-radius: 10px;
    padding: 10px 14px;
    margin-left: 8px;
    cursor: pointer;
  }

  button:hover { background-color: #1565c0; }

  .file-upload {
    display: none;
  }

  .preview {
    max-width: 180px;
    border-radius: 10px;
    margin-top: 5px;
    border: 1px solid #2c3e50;
  }

  .bubble {
    position: absolute;
    background: rgba(255, 255, 255, 0.06);
    border-radius: 50%;
    animation: float 6s ease-in-out infinite;
  }

  @keyframes float {
    0% { transform: translateY(0); }
    50% { transform: translateY(-20px); }
    100% { transform: translateY(0); }
  }
</style>
</head>
<body>
  <div class="chat-container" id="chat-container">
    <div class="bot-message message">Halo! ðŸ‘‹ Saya Roja AI. Ada yang bisa saya bantu?</div>
  </div>

  <div class="input-container">
    <input type="file" id="file-upload" class="file-upload" accept="image/*,.pdf,.txt">
    <button id="upload-btn">ðŸ“Ž</button>
    <input type="text" id="user-input" placeholder="Ketik pesan...">
    <button id="send-btn">Kirim</button>
  </div>

<script>
const API_KEY = "AIzaSyC310duBltZgbkMMfqRoAn6qVELo7x2slI"; // Ganti dengan API key kamu (Gemini atau Imagen)
const chatContainer = document.getElementById('chat-container');
const userInput = document.getElementById('user-input');
const sendBtn = document.getElementById('send-btn');
const uploadBtn = document.getElementById('upload-btn');
const fileUpload = document.getElementById('file-upload');

function addMessage(content, sender) {
  const msg = document.createElement('div');
  msg.classList.add('message', sender === 'user' ? 'user-message' : 'bot-message');
  msg.innerHTML = content;
  chatContainer.appendChild(msg);
  chatContainer.scrollTop = chatContainer.scrollHeight;
}

async function sendMessage(message, imageData = null) {
  addMessage(message, 'user');
  userInput.value = '';
  
  let body = {
    contents: [{
      parts: [{ text: message }]
    }]
  };

  if (imageData) {
    body.contents[0].parts.push({
      inlineData: {
        mimeType: "image/jpeg",
        data: imageData
      }
    });
  }

  addMessage("â³ Sedang diproses...", 'bot');

  try {
    const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${API_KEY}`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(body)
    });

    const data = await res.json();
    const reply = data?.candidates?.[0]?.content?.parts?.[0]?.text || "âš ï¸ Tidak ada respons dari AI.";
    document.querySelectorAll('.bot-message').forEach(b => {
      if (b.textContent === "â³ Sedang diproses...") b.remove();
    });
    addMessage(reply, 'bot');
  } catch (e) {
    addMessage("âŒ Terjadi kesalahan saat menghubungi AI.", 'bot');
  }
}

sendBtn.onclick = () => {
  const msg = userInput.value.trim();
  if (msg) sendMessage(msg);
};

userInput.addEventListener("keypress", e => {
  if (e.key === "Enter") sendBtn.click();
});

uploadBtn.onclick = () => fileUpload.click();

fileUpload.addEventListener("change", async () => {
  const file = fileUpload.files[0];
  if (!file) return;

  if (file.type.startsWith("image/")) {
    const reader = new FileReader();
    reader.onload = e => {
      const imgData = e.target.result.split(",")[1];
      addMessage(`<img src="${e.target.result}" class="preview"><br><i>ðŸ“¸ Gambar diunggah, sedang dianalisis...</i>`, 'user');
      sendMessage("Analisis gambar ini", imgData);
    };
    reader.readAsDataURL(file);
  } else {
    addMessage(`ðŸ“Ž File "${file.name}" berhasil diunggah.`, 'user');
    sendMessage(`Saya baru saja mengunggah file bernama ${file.name}. Tolong bantu analisis isinya.`);
  }
});

// Tambahkan animasi gelembung latar
for (let i = 0; i < 10; i++) {
  const bubble = document.createElement('div');
  bubble.classList.add('bubble');
  bubble.style.width = bubble.style.height = `${Math.random() * 80 + 20}px`;
  bubble.style.left = `${Math.random() * 100}%`;
  bubble.style.top = `${Math.random() * 100}%`;
  bubble.style.animationDelay = `${Math.random() * 6}s`;
  document.body.appendChild(bubble);
}
</script>
</body>
</html>
