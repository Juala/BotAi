<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Roja AI Chat</title>
<style>
  * { box-sizing: border-box; }
  body {
    font-family: 'Poppins', sans-serif;
    margin: 0;
    background-color: #0a0f1c;
    color: white;
    display: flex;
    flex-direction: column;
    height: 100vh;
  }

  .chat-container {
    display: flex;
    flex-direction: column;
    flex: 1;
    position: relative;
  }

  /* === Riwayat Chat === */
  .history {
    background: #0f1629;
    border-bottom: 1px solid #1c2948;
    padding: 8px;
    font-size: 13px;
    color: #9bb0da;
    overflow-x: auto;
    white-space: nowrap;
  }

  .history span {
    background: #1a2236;
    margin-right: 6px;
    padding: 6px 10px;
    border-radius: 8px;
    cursor: pointer;
    display: inline-block;
  }

  .history span:hover { background: #283a63; }

  /* === Chat Box === */
  .chat-box {
    flex: 1;
    overflow-y: auto;
    padding: 15px;
    scroll-behavior: smooth;
  }

  .message {
    max-width: 80%;
    margin-bottom: 16px;
    padding: 10px 14px;
    border-radius: 14px;
    line-height: 1.6;
    position: relative;
    white-space: pre-wrap;
  }

  .user {
    background-color: #1a2236;
    align-self: flex-end;
  }

  .bot {
    background-color: #162037;
    align-self: flex-start;
  }

  .time {
    font-size: 10px;
    color: rgba(255, 255, 255, 0.5);
    position: absolute;
    bottom: -14px;
    right: 10px;
  }

  /* === Input === */
  .input-container {
    display: flex;
    padding: 10px;
    background: #11182b;
    border-top: 1px solid #1e2949;
  }

  input[type="text"] {
    flex: 1;
    padding: 10px;
    border: none;
    border-radius: 10px;
    background: #0d1525;
    color: white;
    font-size: 14px;
  }

  input[type="text"]:focus { outline: none; }

  button {
    background-color: #293a67;
    color: white;
    border: none;
    border-radius: 10px;
    padding: 10px 14px;
    margin-left: 8px;
    cursor: pointer;
    transition: 0.3s;
  }

  button:hover { background-color: #3e5ba5; }

  /* === Indikator Mengetik === */
  .typing {
    display: flex;
    align-items: center;
    gap: 4px;
    padding: 8px 12px;
    background-color: #162037;
    border-radius: 12px;
    width: fit-content;
    margin-bottom: 10px;
  }

  .dot {
    width: 6px;
    height: 6px;
    background: white;
    border-radius: 50%;
    animation: blink 1.4s infinite;
  }

  .dot:nth-child(2) { animation-delay: 0.2s; }
  .dot:nth-child(3) { animation-delay: 0.4s; }

  @keyframes blink {
    0%, 80%, 100% { opacity: 0.2; }
    40% { opacity: 1; }
  }
</style>
</head>
<body>

<div class="chat-container">
  <div class="history" id="chatHistory"></div>
  <div class="chat-box" id="chatBox"></div>
  <div class="input-container">
    <input type="text" id="userInput" placeholder="Ketik pesan..." onkeypress="if(event.key==='Enter'){sendMessage();}">
    <button onclick="sendMessage()">Kirim</button>
  </div>
</div>

<script>
const chatBox = document.getElementById('chatBox');
const chatHistory = document.getElementById('chatHistory');
const input = document.getElementById('userInput');

const GEMINI_API_KEY = "AIzaSyC310duBltZgbkMMfqRoAn6qVELo7x2slI"; // üîë ganti dengan API Key kamu
const GEMINI_URL = "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent";

let history = [];
let conversation = [];

/* === Kirim Pesan === */
async function sendMessage() {
  const message = input.value.trim();
  if (!message) return;

  addMessage('user', message);
  conversation.push({ role: "user", content: message });
  input.value = "";
  simulateTyping();

  try {
    const prompt = conversation.map(m => `${m.role}: ${m.content}`).join("\n");

    const res = await fetch(`${GEMINI_URL}?key=${GEMINI_API_KEY}`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
    });

    const data = await res.json();
    removeTyping();

    const reply = data?.candidates?.[0]?.content?.parts?.[0]?.text || "‚ö†Ô∏è Tidak ada respons dari AI.";
    const formatted = formatAIResponse(reply);

    addMessage('bot', formatted);
    conversation.push({ role: "model", content: reply });
    saveToHistory(message);

  } catch (err) {
    console.error(err);
    removeTyping();
    addMessage('bot', "‚ùå Gagal menghubungi API Gemini.");
  }
}

/* === Tambahkan Pesan ke Chat === */
function addMessage(sender, text) {
  const msg = document.createElement('div');
  msg.classList.add('message', sender);
  msg.innerHTML = text;

  const time = document.createElement('div');
  time.classList.add('time');
  const now = new Date();
  time.textContent = now.getHours().toString().padStart(2, '0') + ':' + now.getMinutes().toString().padStart(2, '0');
  msg.appendChild(time);

  chatBox.appendChild(msg);
  chatBox.scrollTop = chatBox.scrollHeight;
}

/* === Indikator Mengetik === */
function simulateTyping() {
  const typingDiv = document.createElement('div');
  typingDiv.classList.add('typing');
  typingDiv.id = 'typingIndicator';
  typingDiv.innerHTML = '<div class="dot"></div><div class="dot"></div><div class="dot"></div>';
  chatBox.appendChild(typingDiv);
  chatBox.scrollTop = chatBox.scrollHeight;
}
function removeTyping() {
  const typingDiv = document.getElementById('typingIndicator');
  if (typingDiv) typingDiv.remove();
}

/* === Simpan Riwayat Chat === */
function saveToHistory(firstMessage) {
  const title = firstMessage.length > 25 ? firstMessage.slice(0, 25) + "..." : firstMessage;
  if (!history.includes(title)) {
    history.push(title);
    renderHistory();
  }
}
function renderHistory() {
  chatHistory.innerHTML = history.map(h => `<span>${h}</span>`).join('');
}

/* === Format Markdown-like === */
function formatAIResponse(text) {
  return text
    .replace(/\*\*(.*?)\*\*/g, "<b>$1</b>")
    .replace(/\*(.*?)\*/g, "<i>$1</i>")
    .replace(/`(.*?)`/g, "<code>$1</code>")
    .replace(/\n/g, "<br>");
}
</script>

</body>
</html>
